# 이메일 인증 테스트 가이드

## 사전 준비

### 1. Fly.io 백엔드 환경 변수 확인
```powershell
fly secrets list -a haesalfarm-backend
```

다음 환경 변수가 설정되어 있어야 합니다:
- `EMAIL_USER`: 네이버 이메일 주소 (예: haesalfarm@naver.com)
- `EMAIL_PASSWORD`: 네이버 앱 비밀번호 (16자리)

### 2. 프론트엔드 개발 서버 실행
```powershell
cd frontend
npm run dev
```

또는 이미 실행 중이면 브라우저에서 `http://localhost:5173` 접속

## 테스트 절차

### 단계 1: 회원가입 페이지 접속
1. 브라우저에서 `http://localhost:5173/signup` 접속
2. 또는 메인 페이지에서 "회원가입" 클릭

### 단계 2: 이메일 인증 코드 발송
1. **이메일 입력**: 실제로 이메일을 받을 수 있는 주소 입력 (네이버 이메일이 아니어도 됨)
2. **"인증코드 발송" 버튼 클릭**
3. **대기**: 버튼이 "발송중..." → "3:00" (카운트다운)으로 변경되는지 확인

**예상 결과:**
- ✅ 성공: "인증코드 발송" 버튼이 카운트다운으로 변경되고, 인증 코드 입력 필드가 나타남
- ❌ 실패: 빨간색 에러 메시지 표시

### 단계 3: 이메일 수신 확인
1. 입력한 이메일 주소의 **받은편지함** 확인
2. **스팸함**도 확인 (처음 보내는 경우 스팸으로 분류될 수 있음)
3. **이메일 제목**: `[햇살농업건설] 이메일 인증 코드`
4. **인증 코드**: 6자리 숫자 확인 (예: `123456`)

**예상 결과:**
- ✅ 성공: 이메일이 1-2분 내에 도착
- ❌ 실패: 이메일이 도착하지 않음 (백엔드 로그 확인 필요)

### 단계 4: 인증 코드 입력 및 검증
1. 이메일에서 받은 **6자리 인증 코드** 입력
2. **"인증확인" 버튼 클릭**

**예상 결과:**
- ✅ 성공: "✓ 이메일 인증이 완료되었습니다." 메시지 표시
- ❌ 실패: "인증 코드가 올바르지 않습니다." 에러 메시지

### 단계 5: 회원가입 완료
1. 나머지 정보 입력:
   - 아이디 (4자 이상)
   - 이름
   - 비밀번호 (8자 이상)
   - 비밀번호 확인
   - 약관 동의 체크
2. **"가입하기" 버튼 클릭**

**예상 결과:**
- ✅ 성공: 마이페이지로 이동
- ❌ 실패: 에러 메시지 표시

## 문제 해결

### 이메일이 도착하지 않는 경우

#### 1. 백엔드 로그 확인
```powershell
fly logs -a haesalfarm-backend
```

**확인할 내용:**
- `이메일 발송 성공: <messageId>` 메시지가 있는지 확인
- `이메일 발송 실패:` 에러 메시지가 있는지 확인

#### 2. 환경 변수 확인
```powershell
fly secrets list -a haesalfarm-backend
```

**확인할 내용:**
- `EMAIL_USER`와 `EMAIL_PASSWORD`가 설정되어 있는지 확인

#### 3. 네이버 앱 비밀번호 확인
- 네이버 메일 → 설정 → 보안 → 2단계 인증 → 앱 비밀번호
- 앱 비밀번호가 올바른지 확인
- 앱 비밀번호가 만료되지 않았는지 확인

#### 4. 스팸함 확인
- 받은편지함에 없으면 **스팸함** 확인
- 네이버 메일의 경우 "외부 메일함"도 확인

### 인증 코드가 맞지 않는 경우

#### 1. 코드 유효 시간 확인
- 인증 코드는 **10분간 유효**합니다
- 시간이 지났다면 다시 발송하세요

#### 2. 코드 재발송
- 카운트다운이 끝나면 (3분 후) 다시 "인증코드 발송" 버튼 클릭
- 새로운 코드가 발송됩니다

#### 3. 코드 입력 확인
- 6자리 숫자를 정확히 입력했는지 확인
- 공백이나 특수문자가 포함되지 않았는지 확인

### 백엔드 연결 오류

#### 1. 프론트엔드 API URL 확인
브라우저 콘솔에서 확인:
```javascript
console.log('API URL:', import.meta.env.VITE_API_URL)
```

**예상 결과:**
- 개발 환경: `undefined` (Fly.io 백엔드 자동 사용)
- 또는: `https://haesalfarm-backend.fly.dev/api`

#### 2. 네트워크 탭 확인
브라우저 개발자 도구 → Network 탭:
- 요청 URL이 `https://haesalfarm-backend.fly.dev/api/auth/send-verification-code`인지 확인
- 응답 상태 코드 확인 (200 = 성공, 500 = 서버 오류)

## 테스트 체크리스트

- [ ] 회원가입 페이지 접속 성공
- [ ] 이메일 입력 필드 표시
- [ ] "인증코드 발송" 버튼 클릭 가능
- [ ] 인증 코드 발송 요청 성공 (카운트다운 시작)
- [ ] 실제 이메일 수신 (1-2분 내)
- [ ] 인증 코드 입력 필드 표시
- [ ] 인증 코드 입력 및 검증 성공
- [ ] "이메일 인증이 완료되었습니다" 메시지 표시
- [ ] 회원가입 완료 및 마이페이지 이동

## 추가 테스트 시나리오

### 시나리오 1: 잘못된 이메일 형식
- 입력: `test@` (잘못된 형식)
- 예상: "올바른 이메일 형식이 아닙니다." 에러

### 시나리오 2: 이미 가입된 이메일
- 입력: 이미 가입된 이메일 주소
- 예상: "이미 가입된 이메일입니다." 에러

### 시나리오 3: 만료된 인증 코드
- 인증 코드 발송 후 10분 이상 대기
- 예상: "인증 코드가 만료되었습니다." 에러

### 시나리오 4: 잘못된 인증 코드
- 입력: `000000` (존재하지 않는 코드)
- 예상: "인증 코드가 올바르지 않습니다." 에러

## 성공 기준

✅ **모든 체크리스트 항목이 통과**하면 이메일 인증 기능이 정상 작동하는 것입니다.

❌ **실패한 항목이 있으면** 위의 "문제 해결" 섹션을 참고하여 해결하세요.
